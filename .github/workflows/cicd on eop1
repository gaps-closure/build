name: cicd on eop1
run-name: ${{ github.actor }} is testing cicd on eop1
on:
  push:
    branches-ignore:
      - master

jobs:
  devcontainer-test:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
        
    container: 
     image: gapsclosure/closuredev:eop1
     options: --user closure     
    steps:
      - name: closureenv
        run:  source /opt/closure/etc/closureenv; printenv PATH; printenv PYTHONPATH
      - name: what is home
        run: echo $HOME
      - name: test multiline string
        run: |
          cHome="/home/closure"
          source $cHome/.bash_profile
          printenv PATH
          printenv PYTHONPATH
          cd $cHome
          git clone --recurse-submodules https://github.com/gaps-closure/build.git
          checkApps=(case1)
          for cApp in "${checkApps[@]}"; do
          appName=$cApp
          find . -name $appName -print
          echo "### Testing $appName"
          cd build/apps/eop1/$appName
          vstask "CLEAN"
          vstask "A6 CODE GENERATION"
          vstask "BUILD"
          checkFiles=(egress_xdcc ingress_xdcc)
          for i in "${checkFiles[@]}"; do iName="./xdcc/egress_xdcc/partitioned/multithreaded/orange/$i";
          [ -x   $iName ] && echo "executable $iName exists" || { echo "executable $iName is not found"; false; } done
          done
